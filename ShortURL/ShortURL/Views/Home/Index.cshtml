@{
    ViewData["Title"] = "URL Shortener";
}

<div class="text-center">
    <h1 class="display-4">URL Shortener</h1>
    <p>Enter a URL to shorten it.</p>
    
</div>

<div class="row justify-content-center">
    <div class="col-md-8">
        <form method="post" id="shortenForm">
            <div class="mb-3">
                <label for="longUrl" class="form-label">Enter URL</label>
                <input type="url" class="form-control" id="longUrl" name="longUrl" placeholder="https://www.example.com/very/long/url" required>
            </div>
            <div class="mb-3">
                <label for="customCode" class="form-label">Custom Short URL (Optional)</label>
                <div class="input-group">
                    <span class="input-group-text">http://localhost:5201/r/</span>
                    <input type="text" class="form-control" id="customCode" name="customCode" placeholder="Max 10 characters, letters and numbers only" maxlength="10" pattern="[a-zA-Z0-9]+">
                </div>
                <div class="form-text">Leave empty for auto-generated code.</div>
            </div>
            <button class="btn btn-primary" type="submit">Create Short URL</button>
        </form>
        <div id="result" class="mt-3" style="display: none;">
            <h4>Your short URL:</h4>
            <a id="shortUrlLink" href="#" target="_blank"></a>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        document.getElementById('shortenForm').addEventListener('submit', async function (e) {
            e.preventDefault();
            const longUrl = this.longUrl.value;
            const customCode = this.customCode.value.trim();

            const requestBody = { longUrl };
            if (customCode) {
                requestBody.customCode = customCode;
            }

            const response = await fetch('/api/urls/shorten', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(requestBody)
            });

            const data = await response.json();
            
            if (response.ok) {
                const resultDiv = document.getElementById('result');
                const shortUrlLink = document.getElementById('shortUrlLink');
                shortUrlLink.href = data.shortUrl;
                shortUrlLink.textContent = data.shortUrl;
                resultDiv.style.display = 'block';
                
                // Clear form
                this.reset();
            } else {
                alert(data.error || 'Something went wrong.');
            }
        });
    </script>
}